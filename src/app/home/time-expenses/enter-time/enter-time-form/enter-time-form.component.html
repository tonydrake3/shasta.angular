<div class="enter-time-form-tabs">
    <md-tab-group [selectedIndex]="enterTimeTabIndex" (selectedIndexChange)="tabIndexChange($event)">
        <md-tab label="Enter Hours">
        </md-tab>
        <md-tab label="Enter Time In/Time Out">
        </md-tab>
        <md-tab label="Enter Indirect Costs">
        </md-tab>
    </md-tab-group>
</div>
<div class="enter-time-form">
    <form [formGroup]="enterTimeForm" (ngSubmit)="createLines(enterTimeForm)" novalidate>
        <div class="row mb-2" *ngIf="isProjectCostEntry">
            <div class="col-md-12">
                <md-input-container class="form-field">
                    <input type="text" mdInput placeholder="Project" formControlName="project" [mdAutocomplete]="autoProject"
                            (focus)="openProjects()" >
                </md-input-container>
                <md-autocomplete #autoProject="mdAutocomplete" [displayWith]="displayFormatted">
                    <md-option *ngFor="let project of filteredProjects | async" (onSelectionChange)="projectSelected($event)"
                               [value]="project">
                        {{project.Number}} - {{project.Name}}
                    </md-option>
                </md-autocomplete>
            </div>
        </div>

        <div class="row mb-2" *ngIf="systems.length > 1">
            <div class="col-md-12">
                <md-input-container class="form-field">
                    <input type="text" mdInput placeholder="System" formControlName="system" [mdAutocomplete]="autoSystem"
                           (focus)="openSystems()" >
                </md-input-container>
                <md-autocomplete #autoSystem="mdAutocomplete" [displayWith]="displayFormatted">
                    <md-option *ngFor="let system of filteredSystems | async" (onSelectionChange)="systemSelected($event)"
                               [value]="system">
                        {{system.Number}} - {{system.Name}}
                    </md-option>
                </md-autocomplete>
            </div>
        </div>

        <div class="row mb-2" *ngIf="phases.length > 1">
            <div class="col-md-12">
                <md-input-container class="form-field">
                    <input type="text" mdInput placeholder="Phase" formControlName="phase" [mdAutocomplete]="autoPhase"
                           (focus)="openPhases()" >
                </md-input-container>
                <md-autocomplete #autoPhase="mdAutocomplete" [displayWith]="displayFormatted">
                    <md-option *ngFor="let phase of filteredPhases | async" (onSelectionChange)="phaseSelected($event)"
                               [value]="phase">
                        {{phase.Number}} - {{phase.Name}}
                    </md-option>
                </md-autocomplete>
            </div>
        </div>

        <div class="row mb-2" *ngIf="isProjectCostEntry && costCodes.length > 0 || !isProjectCostEntry">
            <div class="col-md-12">
                <md-input-container class="form-field">
                    <input type="text" mdInput placeholder="{{costCodePlaceholder}}" formControlName="costCode" [mdAutocomplete]="autoCostCode"
                           (focus)="openCostCodes()" >
                </md-input-container>
                <md-autocomplete #autoCostCode="mdAutocomplete" [displayWith]="displayCostCode">
                    <md-option *ngFor="let costCode of filteredCostCodes | async" (onSelectionChange)="costCodeSelected($event)"
                               [value]="costCode">
                        {{costCode.Code}} - {{costCode.Name}}
                    </md-option>
                </md-autocomplete>
            </div>
        </div>
        <div class="row" *ngIf="(isProjectCostEntry && enterTimeForm.get('project').value) || enterTimeForm.get('costCode').value">
            <div class="col-md-10">
                <md-input-container class="form-field selected-employees-field">
                    <input type="text" mdInput placeholder="Employees" formControlName="employee" [mdAutocomplete]="autoEmployee"
                           (focus)="openEmployee()">
                </md-input-container>
                <md-autocomplete #autoEmployee="mdAutocomplete" [displayWith]="displayFormatted">
                    <md-option *ngFor="let employee of filteredEmployees | async" (onSelectionChange)="employeeSelected($event)"
                               [value]="employee">
                        {{employee.Number}} - {{employee.Name}}
                    </md-option>
                </md-autocomplete>
            </div>
            <div class="col-md-2 groupings">
                <label>select</label>
                <a (click)="selectAllEmployees()">All</a>
                <a (click)="clearEmployeeSelection()">None</a>
            </div>
        </div>
        <div class="row" *ngIf="(isProjectCostEntry && enterTimeForm.get('project').value) || enterTimeForm.get('costCode').value">
            <div class="col-md-12">
                <div class="enter-time-selected-employees" *ngIf="selectedEmployees.length > 0">
                    <div [ngClass]="getExpandContainer('enter-time-selected-employees-container')">
                        <div class="selected-header" (click)="toggleSelectedEmployees()">
                            <span class="selected-header-label expansion-title-regular">{{selectedEmployees.length}} employees selected</span>
                            <i [ngClass]="getExpandIcon()">keyboard_arrow_up</i>
                        </div>
                        <div [ngClass]="getExpandContainer('selected-employee-list')">
                            <md-chip-list>
                                <md-chip *ngFor="let employee of selectedEmployees" (click)="removeEmployee(employee)">
                                    <span>{{employee.Number}} - {{employee.Name}}</span>
                                    <i class="mdi mdi-close-circle"></i>
                                </md-chip>
                            </md-chip-list>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-md-12" >
                <div esubCloseDateFlyout>
                    <md-input-container class="form-field dates">
                        <md-placeholder>
                            <span class="enter-time-date-placeholder">Dates</span> <i class="material-icons">date_range</i>
                        </md-placeholder>
                        <input mdInput id="txtDates" formControlName="dates" (focus)="onFocus()" (keydown)="clearKeystroke($event)">
                    </md-input-container>
                    <esub-daypicker-flyout [daypickerConfig]="dpDatepickerConfig" [selectedDates]="selectedDates"
                                           (selectedDatesChange)="onDatesChanged($event)" ></esub-daypicker-flyout>
                </div>
            </div>
        </div>

        <div class="row mb-2" class="time-entry-method">
            <div class="col-md-12" *ngIf="!isTimeIn">
                <span class="label-bold">Hours Worked</span>

                <div class="row hours-entry form-field">
                    <div class="col-md-2">
                        <md-input-container>
                            <input mdInput type="number" placeholder="ST" formControlName="standardHours"
                                   maxlength="5" step="0.25" min="0" max="24">
                        </md-input-container>
                    </div>
                    <div class="col-md-2" *ngIf="isProjectCostEntry">
                        <md-input-container>
                            <input mdInput type="number" placeholder="OT" formControlName="overtimeHours"
                                   maxlength="5" step="0.25" min="0" max="24">
                        </md-input-container>
                    </div>
                    <div class="col-md-2" *ngIf="isProjectCostEntry">
                        <md-input-container>
                            <input mdInput type="number" placeholder="DT" formControlName="doubleTimeHours"
                                   maxlength="5" step="0.25" min="0" max="24">
                        </md-input-container>
                    </div>
                </div>

            </div>
            <div class="col-md-12" *ngIf="isTimeIn" formGroupName="timeEntry">
                <div class="row">
                    <div class="col-md-2" formGroupName="time">
                        <div class="time-entry" *ngIf="!isUnsupportedTime">
                            <md-input-container class="form-field" >
                                <input mdInput placeholder="Time in" type="time" formControlName="in">
                            </md-input-container>
                        </div>
                        <div class="time-entry firefox-time" *ngIf="isUnsupportedTime">
                            <md-input-container class="form-field" >
                                <input mdInput placeholder="Time in" type="text" esubTimeInput formControlName="inValue"
                                       (timeChange)="onTimeInChange($event)" (timePeriodChange)="onTimeInPeriodChange($event)">
                            </md-input-container>
                            <md-select [ngClass]="{'ie-offset': isIE }" formControlName="inPeriod"
                                       (change)="onTimeInPeriodSelection($event)">
                                <md-option [value]="'AM'">AM</md-option>
                                <md-option [value]="'PM'">PM</md-option>
                            </md-select>
                        </div>
                    </div>
                    <div class="col-md-2" formGroupName="time">
                        <div class="time-entry" *ngIf="!isUnsupportedTime">
                            <md-input-container class="form-field">
                                <input mdInput placeholder="Time out" type="time" formControlName="out">
                            </md-input-container>
                        </div>
                        <div class="time-entry firefox-time" *ngIf="isUnsupportedTime">
                            <md-input-container class="form-field" >
                                <input mdInput placeholder="Time out" type="text" esubTimeInput formControlName="outValue"
                                       (timeChange)="onTimeOutChange($event)" (timePeriodChange)="onTimeOutPeriodChange($event)">
                            </md-input-container>
                            <md-select [ngClass]="{'ie-offset': isIE }" formControlName="outPeriod">
                                <md-option [value]="'AM'">AM</md-option>
                                <md-option [value]="'PM'">PM</md-option>
                            </md-select>
                        </div>
                    </div>
                    <div class="col-md-2 offset-1" formGroupName="break">
                        <div class="time-entry" *ngIf="!isUnsupportedTime">
                            <md-input-container class="form-field">
                                <input mdInput placeholder="Break in" type="time" formControlName="in">
                            </md-input-container>
                        </div>
                        <div class="time-entry firefox-time" *ngIf="isUnsupportedTime">
                            <md-input-container class="form-field" >
                                <input mdInput placeholder="Break in" type="text" esubTimeInput formControlName="inValue"
                                       (timeChange)="onBreakInChange($event)" (timePeriodChange)="onBreakInPeriodChange($event)">
                            </md-input-container>
                            <md-select [ngClass]="{'ie-offset': isIE }" formControlName="inPeriod">
                                <md-option [value]="'AM'">AM</md-option>
                                <md-option [value]="'PM'">PM</md-option>
                            </md-select>
                        </div>
                    </div>
                    <div class="col-md-2" formGroupName="break">
                        <div class="time-entry" *ngIf="!isUnsupportedTime">
                            <md-input-container class="form-field">
                                <input mdInput placeholder="Break out" type="time" formControlName="out">
                            </md-input-container>
                        </div>
                        <div class="time-entry firefox-time" *ngIf="isUnsupportedTime">
                            <md-input-container class="form-field" >
                                <input mdInput placeholder="Break out" type="text" esubTimeInput formControlName="outValue"
                                       (timeChange)="onBreakOutChange($event)" (timePeriodChange)="onBreakOutPeriodChange($event)">
                            </md-input-container>
                            <md-select [ngClass]="{'ie-offset': isIE }" formControlName="outPeriod">
                                <md-option [value]="'AM'">AM</md-option>
                                <md-option [value]="'PM'">PM</md-option>
                            </md-select>
                        </div>
                    </div>
                </div>
                <div class="row form-error-container">
                    <div class="col-md-4">
                        <span class="form-error" *ngIf="enterTimeForm.get('timeEntry').get('time').hasError('startAfterEnd')">Time in cannot occur after time out.</span>
                    </div>
                    <div class="col-md-4 offset-1">
                        <span class="form-error" *ngIf="enterTimeForm.get('timeEntry').get('break').hasError('breakStartAfterEnd')">Break in cannot occur after break out.</span>
                        <span class="form-error" *ngIf="enterTimeForm.get('timeEntry').hasError('breakOutsideOfTime') &&
                            !enterTimeForm.get('timeEntry').get('break').hasError('breakStartAfterEnd')">Break cannot occur outside of time in/out.</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-1 mb-3">
            <div class="col-md-12">
                <md-input-container class="notes form-field">
                    <input mdInput placeholder="Notes" formControlName="notes">
                </md-input-container>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 esub-button-group">
                <button md-raised-button type="button" class="primary" [disabled]="enterTimeForm.pristine" (click)="clearForm()">Clear form</button>
            </div>
            <div class="col-md-6 esub-button-group">
                <button md-raised-button type="submit" class="secondary" [disabled]="enterTimeForm.invalid">Create {{linesToAddCount()}} time entries</button>
            </div>
        </div>

    </form>

</div>
